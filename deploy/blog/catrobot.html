<!doctype html>
<!-- https://github.com/paulirish/html5-boilerplate/blob/master/index.html -->
<!-- paulirish.com/2008/conditional-stylesheets-vs-css-hacks-answer-neither/ -->
<!--[if lt IE 7 ]> <html lang="en" class="no-js ie6"> <![endif]-->
<!--[if IE 7 ]>    <html lang="en" class="no-js ie7"> <![endif]-->
<!--[if IE 8 ]>    <html lang="en" class="no-js ie8"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--> <html lang="en" class="no-js"> <!--<![endif]-->
<head>
    <meta charset="">

  <!-- Always force latest IE rendering engine (even in intranet) & Chrome Frame
       Remove this if you use the .htaccess -->
  <meta http-equiv="X-UA-Compatible" content="">

  <!-- encoding must be specified within the first 512 bytes
        www.whatwg.org/specs/web-apps/current-work/multipage/semantics.html#charset -->

  <!-- meta element for compatibility mode needs to be before
        all elements except title & meta
        msdn.microsoft.com/en-us/library/cc288325(VS.85).aspx -->
  <!-- Chrome Frame is only invoked if meta element for
        compatibility mode is within the first 1K bytes
        code.google.com/p/chromium/issues/detail?id=23003 -->

  <title>Building a $100 Robot for Cats</title>
  <meta name="description" content="">
  <meta name="author" content="Lakshmi Vyasarajan">

  <!--  Mobile viewport optimized: j.mp/bplateviewport -->
  <meta name="viewport" content="">

    <!-- Place favicon.ico & apple-touch-icon.png
        in the root of your domain and delete these references -->
  <link rel="shortcut icon" href="/media/images/favicon.ico">
  <link rel="apple-touch-icon" href="/media/images/apple-touch-icon.png">

  <link rel="stylesheet" href="/media/css/bootstrap.min.css">
  
  
    <!-- All JavaScript at the bottom, except for Modernizr which
        enables HTML5 elements & feature detects -->
    <script src="/media/js/libs/modernizr-1.7.min.js"></script>
    </head>
<body id="index">
    <div id="container">
            <div id="main" role="main">
          <header class="banner clearfix">
          <div class="bg-success">
          <h1>&emsp; Dr. Robot Alien</h1>
            <h3>&emsp; &emsp; A compendium of eldritch and uncanny experimentations</h3> 
    </div>
          <div class="bg-info">
       <div class="collapse navbar-collapse">
    <ul class="nav navbar-nav">
                <li>
            <a title="Home Page"
                class="button white home"
                href="/index.html">
                Home
            </a>
        </li>        <li>
            <a title="Portfolio"
                class="button white portfolio"
                href="/portfolio">
                Portfolio
            </a>
        </li>        <li class="active">
            <a title="Blog"
                class="button white active blog"
                href="/blog">
                Blog
            </a>
        </li>        <li>
            <a title="About"
                class="button white about"
                href="/about.html">
                About
            </a>
            <a title="Games???"
                class="button white about"
                href="/games.html">
                About
            </a>
        </li>    </ul>
                    </header>
          <section class="content">
          <h1 class="title">Building a $100 Robot for Cats</h1>

Think robotics is hard? Think it's expensive? Think cats are not interested in it? Well, you are wrong*!
</p>
<p>

*Maybe slightly correct about the last one 
</p>
<br>
<p>

As I have previously discussed on this blog, I have an excellent cat named Lily. She loves boxes, string and all the things that make adorable cat videos (except laser pointers, for whatever reason). Basically her only flaw is the same as one of her best qualities: she loves people and she hates to be alone for long periods of time by herself.
</p>

<p><center><img alt="SadLily" height="600" src="/media/images/catrobot-sadlily.jpg" /></center></p>
<center><h5>So sad and so alone</h5></center>
<p>

Previously I lived in a house with four people who all loved her. When I moved to San Francisco, suddenly she had to stay home for hours while I was at work. I considered the possibility of cat sitters or kitty daycare, but for the most part these services don't seem to exist. If you even try to search for these services, the only results that come up are for dogs (give it a try).
</p>
<p>

So, one of my previous roommates and I came up with an idea. I would build robots for Lily. Then we were going to start a Kickstarter to  build an army of cat robots and get people on Twitch to play with my cat. The Kickstarter did not go <a href=https://www.kickstarter.com/projects/232785598/263917521?token=44eedbdc>as well as we had hoped</a>. However I persisted in my efforts to give Lily a robot friend that she could love.
</p>
<p>

I originally became interested in trying to build a robot after reading this post: <a href=https://www.oreilly.com/learning/how-to-build-a-robot-that-sees-with-100-and-tensorflow>How to build a robot that "sees" with $100 and TensorFlow</a>. If you read the article, it is a list of the parts he used and a command that you can run with a pretrained model in Tensorflow on a Raspberry Pi to "see" objects. But, despite the fact that he gives almost no information about how he actually built the robots, the article made it seem affordable enough that I decided to give it a try.
</p>
<p>

In order to build a robot that can drive itself around, you need a chassis and some motors. The Sainsmart chassis that is listed in the article is clearly not the one he used (since both of his robots have four wheels and that one has two), but I purchased it anyway. For anyone with access to a 3D printer and a few DC motors, you can almost undoubtedly make one yourself for the $10 price tag of this chassis (or even less), but I was more than willing to pay to avoid the annoyance.
</p>
<p>

Buying the chassis will absolutely will not help you with building it (it does not come with instructions). In fact, there are so many versions of this chassis, with so many possible configurations of motors and mounting points, that pretty much the best advice for putting it together is to look for videos on Youtube (like <a href=https://www.youtube.com/watch?v=gCQ6A9u5lqA>this</a>). I also found that a few of the screws and connectors that came with my chassis were very poor quality, so again, that may be a good reason to just 3D print and build your own. The most important thing is to make sure you have two DC motors that are compatible with being mounted on your chassis. Once you have mounted your DC motors to your chassis, you will need to solder four wires onto the four posts in order to provide power to the motors.
</p>
<p><center><img alt="Motor" height="400" src="/media/images/catrobot-motor-fix.jpg" /></center></p>
<center><h5>Should look like this</h5></center>
<p><center><img alt="Solder" height="400" src="/media/images/lilyrobot-hownottosolder.jpg" /></center></p>
<center><h5>Don't be like me and solder on a piece of cardboard on your carpet...</h5></center>
<p>

If you buy the Sainsmart chassis, it also comes with a 4 AA/6V power source. Most DC motors should be able to be driven with 6V (and may be as low as 3 or 5V). But, since  the goal is to control the motors with the Raspberry Pi, you need to control the motor power to the wheels using a motor driver. The motor driver will take the lower voltage output of the Raspberry Pi (about 3.3 V) and convert it to the voltage needed by the DC motors.
</p>
<p>

In the article he used a pretty expensive motor hat because he had a few motor drivers get burned out. I think that motor drivers burning out is pretty common in building robots like this, but I purchased the cheap and common L298 motor driver and had no issues for months of operating the robot and hauling it all over the city in my backpack. Only after moving into a new apartment did I manage to kill it. So it is up to you whether you want to get a $10 L298 or a $20 Adafruit motor hat.
</p>
<p>

Since the L298 is common, it is easy to find a diagram to set it up like <a href=http://www.instructables.com/id/Control-DC-and-stepper-motors-with-L298N-Dual-Moto/>this one</a>. The four wires from the motors attach to the four connectors on the sides, and in order to get power it has a 12 V pin and a ground pin. You can attach the positive side (red) of the 6V power supply to the 12V and the negative side(black) to the ground. Since I also used a separate power supply for my Raspberry Pi, the ground from the Raspberry Pi is also attached to the ground of the motor driver. If the two grounds are not the same, the motor driver will not register the voltage difference, and the wheels will not move.
</p>
<p><center><img alt="MotorDriver" height="400" src="/media/images/catrobot-motordriver-fix.jpg" /></center></p>
<center><h5>Some stripped wires for the power and motor connections and some nice female wires for the Raspberry Pi connections</h5></center>
<p>

The motor driver has four pins that are meant to be connected to the Raspberry Pi. Basically those four pins can send a signal to the motor hat, telling it to turn either the left or right wheel either forwards or backwards. On the motor hat these are labeled "IN1, IN2, IN3, IN4". Using the BCM numbering scheme, I connected the Raspberry Pi GPIO 18 to IN1, GPIO 23 to IN2, GPIO 17 to IN3 and GPIO 22 to IN4. 
</p>
<p><center><img alt="RaspPi" height="400" src="/media/images/catrobot-raspberrypi-fix.jpg" /></center></p>
<center><h5>All the wires going into the Raspberry Pi are fancy because it is a fancy robot</h5></center>
<p>

Phew. After all of that you should have the bones of the robot in place. I decorated mine to make it look nice (and also to protect it from being eaten or clawed).

</p>
<p><center><img alt="Chassis" height="400" src="/media/images/catrobot-chassis.jpg" /></center></p>
<center><h5>Mechanical Engineering is not my strong suit...</h5></center>
<p>
So, now that you have all the components, you need to solve the most important question. How do you make a robot that can play with your cat?

</p>
<p><center><img alt="Before" height="400" src="/media/images/catrobot-before.jpg" /></center></p>
<center><h5>I had no problem getting Lily to play with the robot...</h5></center>
<p>
In order to  be able to move, the Raspberry Pi needs to be able to control the motors. The Raspberry Pi can be powered by the motor driver (using its 5V output), or it can be powered through microSD by an external power supply (I used the power bank that is suggested in the article). Then, once the Pi is turned on, you will need a microSD card that has the Raspbian operating system on it. This is the brains that allow the Raspberry Pi to bend the motor hat to its will. If you have a Raspberry Pi 2 the Wheezy distribution works best, and if you have a Raspberry Pi 3 then the Jessie distribution is the correct one. You can easily buy an SD card that has been flashed with Raspbian, or there are several tutorials for setting up an SD card with a Raspbian operating system if you want to try to do it from scratch.

</p>
<p>
You can log onto the Raspberry Pi for the first time by connecting it to a keyboard, mouse and monitor. The default username is pi and the password is raspberry. Once you are logged in, you can use the wpa supplicant to set up your wireless credentials on the Raspberry Pi. Then, in the future, you can log onto it by sshing remotely, without needing the keyboard, mouse and monitor. 
</p>
<p><center><img alt="Wireless" height="600" src="/media/images/catrobot-wireless-fix.jpg" /></center></p>
<center><h5>If you use this file, make sure to use your own user name and password...</h5></center>
<p>

On your machine, you can use ifconfig to determine the network address of your wireless connection. Then, tools like nmap can help you to find the exact IP of the Raspberry Pi. If you are on a busy network and discovering the IP of your Raspberry Pi in this way is difficult, you may want to set up a static IP for it. This method can also be used to connect to the Raspberry Pi by ethernet in order to do the initial setup (if you do not have a keyboard, mouse and monitor).

</p>
<p><center><img alt="network" height="600" src="/media/images/catrobot-network-fix.jpg" /></center></p>
<center><h5>I don't have a monitor, keyboard or mouse.</h5></center>
<p><center><img alt="nmap" height="600" src="/media/images/catrobot-nmap-fix.jpg" /></center></p>
<center><h5>Nmap is good for a lot of things. Go look it up.</h5></center>
<p>
Then, while logged into the Raspberry Pi remotely, you can use the following code to <a href=https://github.com/mamday/scripts/blob/master/motor_control.py> control the car.</a> This assigns the pins that I connected to the motor driver to different variables and initializes the GPIO for each pin. Then the car can be moved for a certain amount of time by using the associated command: l(time) for left, r(time) for right, b(time) for back and f(time) for forwards. 

</p>
<p>
After I got this all to work, I tried it out on my cat. Unfortunately she did not like her new friend. Whenever it got close to her, she would run away. I think it behaved too unnaturally. My jerky motions made the robot seem too menacing.

</p>
<p>
However, I continued to build the robot. After all, I still hadn't added the ability for it to "see" my cat. Obviously it should be possible to get her to like it if it could recognize and respond to her, right?

</p>
<p>
If you buy the camera recommended in the article, installing it in the Raspberry Pi is easy. It fits in the little slot next to the HDMI port. The ribbon cable feels very delicate, but I've found that even if you really cram it in there it is fine. The camera side, however, is actually very sensitive to being jostled. If the little tab on the side of the lens gets displaced even a little bit you will lose contact with the camera.

</p>
<p><center><img alt="Camera" height="400" src="/media/images/catrobot-camera.jpg" /></center></p>
<center><h5>Seriously, be really careful with the thing that slots into the lens</h5></center>
<p>
The web server he recommends in the article for the camera works well. It will create an interface for you at "RaspberryPiIP"/html, where "RaspberryPiIP" is the IP you found previously with nmap. You can take pictures and video using the interface, and it continuously updates an image located at /dev/shm/mjpeg/cam.jpg on the Raspberry Pi.
</p>
<p><center><img alt="webserver" height="400" src="/media/images/catrobot-webserver-fix.jpg" /></center></p>
<center><h5>Pretty nice robot selfie.</h5></center>
<p>
In the article he spends some time talking about how long it took him to install Tensorflow. However, now the instructions are listed on their <a href=https://github.com/tensorflow/tensorflow/blob/master/tensorflow/contrib/pi_examples/README.md>Github page</a> and it is fairly straightforward. The installation took me multiple hours though, so I left it running overnight. Once Tensorflow is built, running the pretrained model on the images from the web server is very simple. You just use the command "tensorflow/contrib/pi_examples/label_image/gen/bin/label_image --image=/dev/shm/mjpeg/cam.jpg" and it will output the top five things it thinks are most likely to be in the image you gave it. 
</p>
<p><center><img alt="Tensorflow" height="600" src="/media/images/catrobot-tensorflow.jpg" /></center></p>
<center><h5>Lily wishes she was an Egyptian cat.</h5></center>
<p>
Although Tensorflow was able to (mostly) identify my cat, this experiment was also a failure for many reasons. One, it takes almost ten seconds for the algorithm to run, even on this pretrained model. Also, if my cat is even slightly out of the frame, it starts guessing things like "Boston Bull" and "Cardigan".
</p>
<p><center><img alt="TensorflowFail" height="600" src="/media/images/catrobot-tensorflowfail.jpg" /></center></p>
<center><h5>Ways Lily is like a cardigan: Soft, warm. Ways Lily is not like a cardigan: All other ways</h5></center>
<p>
So, at the moment, my cat continues to be without a friend. I am looking into different ways to try to get her to embrace her robot friend and live happily in our robot future. Until then, I guess there are always more boxes.
</p>

          </section>
      </div>
      </div> <!--! end of #container -->
  <footer>
      Powered by <a href="http://ringce.com/hyde">hyde</a>.
  </footer>
      <!-- Javascript at the bottom for fast page loading -->
    <!-- Grab Google CDN's jQuery, with a protocol relative URL; fall back to local if necessary -->
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.js"></script>
  <script>window.jQuery || document.write('<script src="js/libs/jquery-1.5.1.min.js">\x3C/script>')</script>
  
    

  <!--[if lt IE 7 ]>
    <script src="js/libs/dd_belatedpng.js"></script>
    <script>DD_belatedPNG.fix('img, .png_bg'); // Fix any <img> or .png_bg bg-images. Also, please read goo.gl/mZiyb </script>
  <![endif]-->

      
  </body>
</html>
